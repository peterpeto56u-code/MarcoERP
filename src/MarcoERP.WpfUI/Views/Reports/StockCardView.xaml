<UserControl x:Class="MarcoERP.WpfUI.Views.Reports.StockCardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:common="clr-namespace:MarcoERP.WpfUI.Common"
             FlowDirection="RightToLeft">
    <DockPanel Margin="16">
        <Border DockPanel.Dock="Top" Style="{StaticResource CardPanel}" Padding="16" Margin="0,0,0,8">
            <StackPanel>
                <TextBlock Text="بطاقة الصنف" Style="{StaticResource PageTitle}" Margin="0,0,0,12" />
                <WrapPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                        <TextBlock Text="الصنف:" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ComboBox ItemsSource="{Binding Products}" SelectedItem="{Binding SelectedProduct}"
                                  DisplayMemberPath="NameAr" Width="220" IsEditable="True"
                                  materialDesign:HintAssist.Hint="الصنف (F1 للبحث)"
                                  common:F1SearchBehavior.IsEnabled="True"
                                  common:F1SearchBehavior.Title="بحث الأصناف" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                        <TextBlock Text="المستودع:" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ComboBox ItemsSource="{Binding Warehouses}" SelectedItem="{Binding SelectedWarehouse}"
                                  DisplayMemberPath="NameAr" Width="180" IsEditable="True"
                                  materialDesign:HintAssist.Hint="المخزن (F1 للبحث)"
                                  common:F1SearchBehavior.IsEnabled="True"
                                  common:F1SearchBehavior.Title="بحث المخازن" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                        <TextBlock Text="من:" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <DatePicker SelectedDate="{Binding FromDate}" Width="140" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,16,8">
                        <TextBlock Text="إلى:" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <DatePicker SelectedDate="{Binding ToDate}" Width="140" />
                    </StackPanel>
                    <Button Content="عرض" Command="{Binding GenerateCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="16,6" Margin="0,0,0,8" />
                    <Button Content="PDF" Command="{Binding ExportPdfCommand}" Margin="8,0,0,8"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="12,4" />
                    <Button Content="Excel" Command="{Binding ExportExcelCommand}" Margin="4,0,0,8"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="12,4" />
                </WrapPanel>
            </StackPanel>
        </Border>
        <Border DockPanel.Dock="Top" Style="{StaticResource CardPanel}" Padding="12" Margin="0,0,0,8">
            <UniformGrid Columns="5">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="الصنف" FontSize="11" Foreground="Gray" HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding ProductName}" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="الرصيد الافتتاحي" FontSize="11" Foreground="Gray" HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding OpeningBalance, StringFormat=N3}" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="إجمالي الوارد" FontSize="11" Foreground="Gray" HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding TotalIn, StringFormat=N3}" FontWeight="Bold" FontSize="14"
                               Foreground="{StaticResource SuccessBrush}" HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="إجمالي الصادر" FontSize="11" Foreground="Gray" HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding TotalOut, StringFormat=N3}" FontWeight="Bold" FontSize="14"
                               Foreground="{StaticResource DangerBrush}" HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="الرصيد الختامي" FontSize="11" Foreground="Gray" HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding ClosingBalance, StringFormat=N3}" FontWeight="Bold" FontSize="14"
                               Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center" />
                </StackPanel>
            </UniformGrid>
        </Border>
        <Border DockPanel.Dock="Bottom" Background="{StaticResource ErrorBackgroundBrush}" CornerRadius="4" Padding="8" Margin="0,4,0,0"
                Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="{Binding ErrorMessage}" Foreground="{StaticResource DangerBrush}" FontSize="12" />
        </Border>
        <DataGrid ItemsSource="{Binding Rows}" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False"
                  materialDesign:DataGridAssist.CellPadding="10 6" Background="White">
            <DataGrid.Columns>
                <DataGridTextColumn Header="التاريخ" Binding="{Binding MovementDate, StringFormat=yyyy-MM-dd}" Width="100" />
                <DataGridTextColumn Header="نوع الحركة" Binding="{Binding MovementTypeName}" Width="120" />
                <DataGridTextColumn Header="المرجع" Binding="{Binding ReferenceNumber}" Width="110" />
                <DataGridTextColumn Header="المصدر" Binding="{Binding SourceTypeName}" Width="110" />
                <DataGridTextColumn Header="المستودع" Binding="{Binding WarehouseName}" Width="120" />
                <DataGridTextColumn Header="وارد" Binding="{Binding QuantityIn, StringFormat=N3}" Width="90">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock"><Setter Property="Foreground" Value="{StaticResource SuccessBrush}" /></Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="صادر" Binding="{Binding QuantityOut, StringFormat=N3}" Width="90">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock"><Setter Property="Foreground" Value="{StaticResource DangerBrush}" /></Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="التكلفة" Binding="{Binding UnitCost, StringFormat=N2}" Width="90" />
                <DataGridTextColumn Header="الرصيد" Binding="{Binding BalanceAfter, StringFormat=N3}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock"><Setter Property="FontWeight" Value="SemiBold" /></Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
