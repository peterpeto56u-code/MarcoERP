<UserControl x:Class="MarcoERP.WpfUI.Views.Reports.AccountStatementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:common="clr-namespace:MarcoERP.WpfUI.Common"
             FlowDirection="RightToLeft">

    <DockPanel Margin="16">

        <!-- Header & Filters -->
        <Border DockPanel.Dock="Top" Style="{StaticResource CardPanel}" Padding="16" Margin="0,0,0,12">
            <StackPanel>
                <TextBlock Text="كشف حساب" Style="{StaticResource PageTitle}" Margin="0,0,0,12" />

                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="الحساب:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <ComboBox ItemsSource="{Binding Accounts}" SelectedItem="{Binding SelectedAccount}"
                              DisplayMemberPath="AccountNameAr" Width="250"
                              materialDesign:HintAssist.Hint="اختر حساب (F1 للبحث)" IsEditable="True"
                              common:F1SearchBehavior.IsEnabled="True"
                              common:F1SearchBehavior.Title="بحث الحسابات"
                              Margin="0,0,16,0" />
                    <TextBlock Text="من:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <DatePicker SelectedDate="{Binding FromDate}" Width="140" Margin="0,0,16,0" />
                    <TextBlock Text="إلى:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <DatePicker SelectedDate="{Binding ToDate}" Width="140" Margin="0,0,16,0" />
                    <Button Content="عرض" Command="{Binding GenerateCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="16,6" />
                    <Button Content="PDF" Command="{Binding ExportPdfCommand}" Margin="8,0,0,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="12,4" />
                    <Button Content="Excel" Command="{Binding ExportExcelCommand}" Margin="4,0,0,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="12,4" />
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Account Info & Balances -->
        <Border DockPanel.Dock="Top" Style="{StaticResource CardPanel}" Padding="12" Margin="0,0,0,8"
                Visibility="{Binding AccountName, Converter={StaticResource NullToVisibilityConverter}}">
            <UniformGrid Columns="4">
                <StackPanel Margin="8,0">
                    <TextBlock Text="الحساب" FontSize="12" Foreground="{StaticResource SubtitleBrush}" />
                    <TextBlock FontSize="14" FontWeight="SemiBold">
                        <Run Text="{Binding AccountCode, Mode=OneWay}" />
                        <Run Text=" — " />
                        <Run Text="{Binding AccountName, Mode=OneWay}" />
                    </TextBlock>
                </StackPanel>
                <StackPanel Margin="8,0">
                    <TextBlock Text="الرصيد الافتتاحي" FontSize="12" Foreground="{StaticResource SubtitleBrush}" />
                    <TextBlock Text="{Binding OpeningBalance, StringFormat=N2}" FontSize="14" FontWeight="SemiBold" />
                </StackPanel>
                <StackPanel Margin="8,0">
                    <TextBlock Text="مجموع المدين / الدائن" FontSize="12" Foreground="{StaticResource SubtitleBrush}" />
                    <TextBlock FontSize="14">
                        <Run Text="{Binding TotalDebit, StringFormat=N2, Mode=OneWay}" Foreground="{StaticResource SuccessBrush}" />
                        <Run Text=" / " />
                        <Run Text="{Binding TotalCredit, StringFormat=N2, Mode=OneWay}" Foreground="{StaticResource DangerBrush}" />
                    </TextBlock>
                </StackPanel>
                <StackPanel Margin="8,0">
                    <TextBlock Text="الرصيد الختامي" FontSize="12" Foreground="{StaticResource SubtitleBrush}" />
                    <TextBlock Text="{Binding ClosingBalance, StringFormat=N2}" FontSize="16"
                               FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}" />
                </StackPanel>
            </UniformGrid>
        </Border>

        <!-- Error -->
        <Border DockPanel.Dock="Bottom" Background="{StaticResource ErrorBackgroundBrush}" CornerRadius="4" Padding="8" Margin="0,4,0,0"
                Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="{Binding ErrorMessage}" Foreground="{StaticResource DangerBrush}" FontSize="12" />
        </Border>

        <!-- DataGrid -->
        <DataGrid ItemsSource="{Binding Rows}" AutoGenerateColumns="False"
                  IsReadOnly="True" CanUserAddRows="False"
                  materialDesign:DataGridAssist.CellPadding="10 6"
                  VerticalScrollBarVisibility="Auto" Background="White">
            <DataGrid.Columns>
                <DataGridTextColumn Header="التاريخ" Binding="{Binding Date, StringFormat=yyyy-MM-dd}" Width="110" />
                <DataGridTextColumn Header="رقم القيد" Binding="{Binding JournalNumber}" Width="120" />
                <DataGridTextColumn Header="المصدر" Binding="{Binding SourceTypeName}" Width="100" />
                <DataGridTextColumn Header="البيان" Binding="{Binding Description}" Width="*" />
                <DataGridTextColumn Header="مدين" Binding="{Binding DebitAmount, StringFormat=N2}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Left" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="دائن" Binding="{Binding CreditAmount, StringFormat=N2}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Left" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="الرصيد" Binding="{Binding RunningBalance, StringFormat=N2}" Width="130">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Left" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
