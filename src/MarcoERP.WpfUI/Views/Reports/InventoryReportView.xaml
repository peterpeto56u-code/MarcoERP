<UserControl x:Class="MarcoERP.WpfUI.Views.Reports.InventoryReportView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:common="clr-namespace:MarcoERP.WpfUI.Common"
             FlowDirection="RightToLeft">
    <DockPanel Margin="16">
        <Border DockPanel.Dock="Top" Style="{StaticResource CardPanel}" Padding="16" Margin="0,0,0,12">
            <StackPanel>
                <TextBlock Text="تقرير المخزون" Style="{StaticResource PageTitle}" Margin="0,0,0,12" />
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="المستودع:" VerticalAlignment="Center" Margin="0,0,8,0" />
                    <ComboBox ItemsSource="{Binding Warehouses}" SelectedItem="{Binding SelectedWarehouse}"
                              DisplayMemberPath="NameAr" Width="200" IsEditable="True"
                              materialDesign:HintAssist.Hint="جميع المستودعات (F1 للبحث)"
                              common:F1SearchBehavior.IsEnabled="True"
                              common:F1SearchBehavior.Title="بحث المخازن"
                              Margin="0,0,16,0" />
                    <Button Content="عرض" Command="{Binding GenerateCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="16,6" />
                    <Button Content="PDF" Command="{Binding ExportPdfCommand}" Margin="8,0,0,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="12,4" />
                    <Button Content="Excel" Command="{Binding ExportExcelCommand}" Margin="4,0,0,0"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4" Padding="12,4" />
                </StackPanel>
            </StackPanel>
        </Border>
        <Border DockPanel.Dock="Bottom" Style="{StaticResource CardPanel}" Padding="12" Margin="0,8,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="عدد الأصناف:" FontWeight="SemiBold" Margin="0,0,4,0" />
                <TextBlock Text="{Binding TotalItems}" FontWeight="Bold" Margin="0,0,24,0" />
                <TextBlock Text="إجمالي القيمة:" FontWeight="SemiBold" Margin="0,0,4,0" />
                <TextBlock Text="{Binding TotalValue, StringFormat=N2}" FontWeight="Bold"
                           Foreground="{StaticResource PrimaryBrush}" Margin="0,0,24,0" />
                <TextBlock Text="تحت الحد الأدنى:" FontWeight="SemiBold" Margin="0,0,4,0" />
                <TextBlock Text="{Binding BelowMinCount}" FontWeight="Bold"
                           Foreground="{StaticResource DangerBrush}" />
            </StackPanel>
        </Border>
        <Border DockPanel.Dock="Bottom" Background="{StaticResource ErrorBackgroundBrush}" CornerRadius="4" Padding="8" Margin="0,4,0,0"
                Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="{Binding ErrorMessage}" Foreground="{StaticResource DangerBrush}" FontSize="12" />
        </Border>
        <DataGrid ItemsSource="{Binding Rows}" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False"
                  materialDesign:DataGridAssist.CellPadding="10 6" Background="White">
            <DataGrid.Columns>
                <DataGridTextColumn Header="كود الصنف" Binding="{Binding ProductCode}" Width="100" />
                <DataGridTextColumn Header="اسم الصنف" Binding="{Binding ProductName}" Width="*" />
                <DataGridTextColumn Header="التصنيف" Binding="{Binding CategoryName}" Width="120" />
                <DataGridTextColumn Header="المستودع" Binding="{Binding WarehouseName}" Width="120" />
                <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity, StringFormat=N3}" Width="90" />
                <DataGridTextColumn Header="الوحدة" Binding="{Binding UnitName}" Width="80" />
                <DataGridTextColumn Header="سعر التكلفة" Binding="{Binding CostPrice, StringFormat=N2}" Width="100" />
                <DataGridTextColumn Header="القيمة" Binding="{Binding TotalValue, StringFormat=N2}" Width="110">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="FontWeight" Value="SemiBold" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTemplateColumn Header="حالة" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <materialDesign:PackIcon>
                                <materialDesign:PackIcon.Style>
                                    <Style TargetType="materialDesign:PackIcon">
                                        <Setter Property="Kind" Value="Check" />
                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsBelowMinimum}" Value="True">
                                                <Setter Property="Kind" Value="AlertCircle" />
                                                <Setter Property="Foreground" Value="{StaticResource DangerBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </materialDesign:PackIcon.Style>
                            </materialDesign:PackIcon>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
