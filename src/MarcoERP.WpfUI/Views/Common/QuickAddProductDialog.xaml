<Window x:Class="MarcoERP.WpfUI.Views.Common.QuickAddProductDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:common="clr-namespace:MarcoERP.WpfUI.Common"
        Title="إضافة صنف سريع"
        Width="460" SizeToContent="Height" MaxHeight="580"
        WindowStartupLocation="CenterOwner"
        FlowDirection="RightToLeft"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        FontFamily="Segoe UI"
        TextElement.FontSize="12"
        FocusManager.FocusedElement="{Binding ElementName=txtNameAr}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <Border Padding="16,12" Background="White">
        <StackPanel>

            <!-- ═══ Header ═══ -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <materialDesign:PackIcon Kind="PackageVariantPlus" Width="22" Height="22"
                                         Foreground="{StaticResource PrimaryBrush}" VerticalAlignment="Center" />
                <TextBlock Text="إضافة صنف سريع" FontSize="16" FontWeight="SemiBold"
                           Foreground="{StaticResource PrimaryBrush}" Margin="8,0,0,0" VerticalAlignment="Center" />
            </StackPanel>

            <!-- ═══ Error ═══ -->
            <Border CornerRadius="4" Padding="8,4" Margin="0,0,0,6"
                    Background="#FFF3E0" BorderBrush="#FFE0B2" BorderThickness="1"
                    Visibility="{Binding HasError, Converter={StaticResource BoolToVis}}">
                <TextBlock Text="{Binding ErrorMessage}" Foreground="#E65100" FontSize="11" TextWrapping="Wrap" />
            </Border>

            <!-- ═══ Section: Basic Data ═══ -->
            <Border BorderBrush="#ECEFF1" BorderThickness="0,0,0,1" Padding="0,0,0,8" Margin="0,0,0,6">
                <StackPanel>
                    <TextBlock Text="بيانات أساسية" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,6"
                               Foreground="{StaticResource PrimaryBrush}" />

                    <!-- Arabic Name -->
                    <TextBox x:Name="txtNameAr"
                             Text="{Binding NameAr, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="اسم الصنف بالعربي *"
                             materialDesign:HintAssist.IsFloating="True"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             FontSize="13" Padding="8,6" Margin="0,0,0,6"
                             PreviewKeyDown="Field_EnterToNext" />

                    <!-- English Name -->
                    <TextBox Text="{Binding NameEn, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="English name"
                             materialDesign:HintAssist.IsFloating="True"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             FontSize="12" Padding="6,4" Margin="0,0,0,6"
                             FlowDirection="LeftToRight"
                             PreviewKeyDown="Field_EnterToNext" />

                    <!-- Category + Base Unit -->
                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="6" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <ComboBox Grid.Column="0" ItemsSource="{Binding Categories}"
                                  SelectedValue="{Binding CategoryId}"
                                  SelectedValuePath="Id" DisplayMemberPath="NameAr"
                                  materialDesign:HintAssist.Hint="التصنيف *"
                                  materialDesign:HintAssist.IsFloating="True"
                                  IsEditable="True"
                                  common:F1SearchBehavior.IsEnabled="True"
                                  common:F1SearchBehavior.Title="بحث التصنيفات"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                  FontSize="12" Padding="6,4"
                                  PreviewKeyDown="Field_EnterToNext" />
                        <ComboBox Grid.Column="2" ItemsSource="{Binding Units}"
                                  SelectedValue="{Binding BaseUnitId}"
                                  SelectedValuePath="Id" DisplayMemberPath="NameAr"
                                  materialDesign:HintAssist.Hint="الوحدة الأساسية *"
                                  materialDesign:HintAssist.IsFloating="True"
                                  IsEditable="True"
                                  common:F1SearchBehavior.IsEnabled="True"
                                  common:F1SearchBehavior.Title="بحث وحدة"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                  FontSize="12" Padding="6,4"
                                  PreviewKeyDown="Field_EnterToNext" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- ═══ Section: Pricing ═══ -->
            <Border BorderBrush="#ECEFF1" BorderThickness="0,0,0,1" Padding="0,0,0,8" Margin="0,0,0,6">
                <StackPanel>
                    <TextBlock Text="التسعير" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,6"
                               Foreground="#2E7D32" />

                    <Grid Margin="0,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="6" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="6" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 Text="{Binding CostPrice, StringFormat=N2, UpdateSourceTrigger=LostFocus}"
                                 materialDesign:HintAssist.Hint="سعر التكلفة"
                                 materialDesign:HintAssist.IsFloating="True"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 FontSize="12" Padding="6,4" FlowDirection="LeftToRight"
                                 PreviewKeyDown="Field_EnterToNext" />
                        <TextBox Grid.Column="2"
                                 Text="{Binding SalePrice, StringFormat=N2, UpdateSourceTrigger=LostFocus}"
                                 materialDesign:HintAssist.Hint="سعر البيع *"
                                 materialDesign:HintAssist.IsFloating="True"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 FontSize="12" Padding="6,4" FlowDirection="LeftToRight"
                                 PreviewKeyDown="Field_EnterToNext" />
                        <TextBox Grid.Column="4"
                                 Text="{Binding VatRate, StringFormat=N2, UpdateSourceTrigger=LostFocus}"
                                 materialDesign:HintAssist.Hint="ضريبة %"
                                 materialDesign:HintAssist.IsFloating="True"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 FontSize="12" Padding="6,4" FlowDirection="LeftToRight"
                                 PreviewKeyDown="Field_EnterToNext" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- ═══ Section: Barcode ═══ -->
            <TextBox Text="{Binding Barcode, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:HintAssist.Hint="الباركود"
                     materialDesign:HintAssist.IsFloating="True"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     FontSize="12" Padding="6,4" Margin="0,0,0,10"
                     FlowDirection="LeftToRight"
                     PreviewKeyDown="Field_EnterToNext" />

            <!-- ═══ Buttons ═══ -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Button Grid.Column="1"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="{StaticResource SuccessBrush}" Foreground="White"
                        Click="Save_Click" Margin="3,0" Height="34" Padding="18,0"
                        IsEnabled="{Binding CanSave}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ContentSave" Width="16" Height="16" VerticalAlignment="Center" />
                        <TextBlock Text="حفظ" Margin="6,0,0,0" VerticalAlignment="Center" FontSize="12" />
                    </StackPanel>
                </Button>
                <Button Grid.Column="2"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Click="Cancel_Click" Margin="3,0" Height="34" Padding="14,0">
                    <TextBlock Text="إلغاء" FontSize="12" />
                </Button>
            </Grid>

            <!-- ═══ Loading ═══ -->
            <ProgressBar IsIndeterminate="{Binding IsBusy}" Height="3" Margin="0,6,0,0"
                         Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}" />
        </StackPanel>
    </Border>
</Window>
