<UserControl x:Class="MarcoERP.WpfUI.Views.Settings.GovernanceIntegrityView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:local="clr-namespace:MarcoERP.WpfUI.Common"
             FlowDirection="RightToLeft" Background="White"
             local:LoadedCommandBehavior.Command="{Binding LoadCommand}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ── Header ─────────────────────────────────── -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="20,14">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock Text="فحص سلامة الحوكمة" FontSize="22" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Governance Integrity Check" FontSize="12" Foreground="{StaticResource SecondaryTextBrush}"
                               FlowDirection="LeftToRight" HorizontalAlignment="Left" Margin="0,2,0,0"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Text="DB:" Foreground="{StaticResource SecondaryTextBrush}" FontSize="12" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding CurrentDbVersion}" Foreground="White" FontWeight="Bold"
                                   FontSize="12" VerticalAlignment="Center"/>
                        <TextBlock Text="  |  Code:" Foreground="{StaticResource SecondaryTextBrush}" FontSize="12" VerticalAlignment="Center" Margin="4,0,4,0"/>
                        <TextBlock Text="{Binding CurrentCodeVersion}" Foreground="White" FontWeight="Bold"
                                   FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                    <Button Content="تشغيل الفحص" Command="{Binding RunChecksCommand}"
                            Style="{StaticResource MaterialDesignFlatLightBgButton}" Foreground="White"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ── Overall Status Banner ─────────────────── -->
        <Border Grid.Row="1" Padding="14,10"
                Visibility="{Binding HasResults, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border CornerRadius="6" Padding="16,10">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{StaticResource ErrorBackgroundBrush}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding OverallStatus}" Value="سليم ✓">
                                <Setter Property="Background" Value="#E8F5E9"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding OverallStatus}" Value="يوجد تحذيرات ⚡">
                                <Setter Property="Background" Value="#FFF8E1"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <materialDesign:PackIcon Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,8,0">
                        <materialDesign:PackIcon.Style>
                            <Style TargetType="materialDesign:PackIcon">
                                <Setter Property="Kind" Value="AlertCircle"/>
                                <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding OverallStatus}" Value="سليم ✓">
                                        <Setter Property="Kind" Value="CheckCircle"/>
                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding OverallStatus}" Value="يوجد تحذيرات ⚡">
                                        <Setter Property="Kind" Value="Alert"/>
                                        <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </materialDesign:PackIcon.Style>
                    </materialDesign:PackIcon>
                    <TextBlock Text="{Binding OverallStatus}" FontSize="18" FontWeight="Bold" VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding OverallStatus}" Value="سليم ✓">
                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding OverallStatus}" Value="يوجد تحذيرات ⚡">
                                        <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <TextBlock Text="{Binding CheckDate}" Foreground="#999" FontSize="12"
                               VerticalAlignment="Center" Margin="20,0,0,0"/>
                </StackPanel>
            </Border>
        </Border>

        <!-- ── Check Results DataGrid ─────────────────── -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding CheckResults}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  Margin="14,10"
                  RowHeight="60"
                  ColumnHeaderHeight="40"
                  Background="White"
                  BorderBrush="#E0E0E0"
                  BorderThickness="1"
                  HorizontalGridLinesBrush="#F0F0F0">

            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
                    <Setter Property="Foreground" Value="#333"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="FontSize" Value="13"/>
                    <Setter Property="Padding" Value="10,8"/>
                    <Setter Property="BorderBrush" Value="#E0E0E0"/>
                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>

            <DataGrid.Columns>
                <!-- Check Name -->
                <DataGridTextColumn Header="الفحص" Binding="{Binding CheckName}" Width="220">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="Padding" Value="8,0"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Status with color coding -->
                <DataGridTextColumn Header="الحالة" Binding="{Binding Status}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="FontSize" Value="13"/>
                            <Setter Property="FlowDirection" Value="LeftToRight"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Status}" Value="OK">
                                    <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Warning">
                                    <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Critical">
                                    <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Message -->
                <DataGridTextColumn Header="التفاصيل" Binding="{Binding Message}" Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="Padding" Value="8,4"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- ── Status Bar ─────────────────────────────── -->
        <Border Grid.Row="3" Background="{StaticResource BackgroundBrush}" Padding="14,8">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}" Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock Text="{Binding ErrorMessage}" Foreground="{StaticResource DangerBrush}"
                           Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}"
                           HorizontalAlignment="Left"/>
                <ProgressBar IsIndeterminate="True" HorizontalAlignment="Right" Width="120"
                             Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
