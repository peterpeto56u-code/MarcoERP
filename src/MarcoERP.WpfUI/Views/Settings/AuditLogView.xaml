<UserControl x:Class="MarcoERP.WpfUI.Views.Settings.AuditLogView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:local="clr-namespace:MarcoERP.WpfUI.Common"
             FlowDirection="RightToLeft" Background="White"
             local:LoadedCommandBehavior.Command="{Binding LoadDataCommand}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ── Header ─────────────────────────────────── -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="20,14">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="FileDocumentEdit" Width="28" Height="28"
                                             Foreground="White" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBlock Text="سجل المراجعة" FontSize="22" FontWeight="Bold" Foreground="White"
                               VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="تحديث" Command="{Binding LoadDataCommand}"
                            Style="{StaticResource MaterialDesignFlatLightBgButton}" Foreground="White"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ── Filter Bar ─────────────────────────────── -->
        <Border Grid.Row="1" Background="{StaticResource BackgroundBrush}" Padding="14,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Start Date -->
                <TextBlock Grid.Column="0" Text="من تاريخ:" VerticalAlignment="Center" Margin="0,0,6,0"
                           FontSize="12" FontWeight="SemiBold"/>
                <DatePicker Grid.Column="1" SelectedDate="{Binding StartDate, Mode=TwoWay}"
                            Width="140" Margin="0,0,12,0" VerticalAlignment="Center"
                            materialDesign:HintAssist.Hint="من تاريخ"/>

                <!-- End Date -->
                <TextBlock Grid.Column="2" Text="إلى تاريخ:" VerticalAlignment="Center" Margin="0,0,6,0"
                           FontSize="12" FontWeight="SemiBold"/>
                <DatePicker Grid.Column="3" SelectedDate="{Binding EndDate, Mode=TwoWay}"
                            Width="140" Margin="0,0,12,0" VerticalAlignment="Center"
                            materialDesign:HintAssist.Hint="إلى تاريخ"/>

                <!-- Entity Type Filter -->
                <TextBox Grid.Column="4" Text="{Binding EntityTypeFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Width="140" Margin="0,0,12,0" VerticalAlignment="Center"
                         materialDesign:HintAssist.Hint="نوع الكيان"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

                <!-- Username Filter -->
                <TextBox Grid.Column="5" Text="{Binding UsernameFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Width="140" Margin="0,0,12,0" VerticalAlignment="Center"
                         materialDesign:HintAssist.Hint="المستخدم"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

                <!-- Search & Clear Buttons -->
                <StackPanel Grid.Column="6" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="بحث" Command="{Binding SearchCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="{StaticResource PrimaryBrush}" Foreground="White" Margin="0,0,6,0"/>
                    <Button Content="مسح" Command="{Binding ClearFiltersCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}" Margin="0,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ── Audit Log DataGrid ─────────────────────── -->
        <Border Grid.Row="2" Margin="14,6">
            <DataGrid ItemsSource="{Binding AuditLogs}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      Style="{StaticResource MaterialDesignDataGrid}"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Auto"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      EnableRowVirtualization="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="التاريخ"
                                        Binding="{Binding Timestamp, StringFormat='{}{0:yyyy/MM/dd HH:mm:ss}'}"
                                        Width="160"/>
                    <DataGridTextColumn Header="نوع الكيان"
                                        Binding="{Binding EntityType}"
                                        Width="130"/>
                    <DataGridTextColumn Header="رقم الكيان"
                                        Binding="{Binding EntityId}"
                                        Width="90"/>
                    <DataGridTextColumn Header="الإجراء"
                                        Binding="{Binding Action}"
                                        Width="120"/>
                    <DataGridTextColumn Header="المستخدم"
                                        Binding="{Binding PerformedBy}"
                                        Width="120"/>
                    <DataGridTextColumn Header="التفاصيل"
                                        Binding="{Binding Details}"
                                        Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- ── Status Bar ─────────────────────────────── -->
        <Border Grid.Row="3" Background="{StaticResource BackgroundBrush}" Padding="14,8">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}" Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock Text="{Binding ErrorMessage}" Foreground="{StaticResource DangerBrush}"
                           Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}"
                           HorizontalAlignment="Left"/>
                <ProgressBar IsIndeterminate="{Binding IsBusy}" HorizontalAlignment="Right" Width="120"
                             Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
