<Window x:Class="MarcoERP.WpfUI.Views.Treasury.QuickCashPaymentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:MarcoERP.WpfUI.Common"
        Title="سند صرف سريع"
        Height="620" Width="550"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        FlowDirection="RightToLeft"
        Background="{DynamicResource MaterialDesignPaper}">

    <Grid Margin="16" local:LoadedCommandBehavior.Command="{Binding LoadedCommand}">
        <Border Style="{StaticResource CardPanel}" Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />   <!-- Header -->
                    <RowDefinition Height="Auto" />   <!-- Document Number -->
                    <RowDefinition Height="Auto" />   <!-- Date -->
                    <RowDefinition Height="Auto" />   <!-- Cashbox -->
                    <RowDefinition Height="Auto" />   <!-- Supplier -->
                    <RowDefinition Height="Auto" />   <!-- Current Balance -->
                    <RowDefinition Height="Auto" />   <!-- Amount -->
                    <RowDefinition Height="Auto" />   <!-- Balance After -->
                    <RowDefinition Height="Auto" />   <!-- Beneficiary -->
                    <RowDefinition Height="Auto" />   <!-- Description -->
                    <RowDefinition Height="Auto" />   <!-- Notes -->
                    <RowDefinition Height="*" />       <!-- Spacer -->
                    <RowDefinition Height="Auto" />   <!-- Buttons -->
                    <RowDefinition Height="Auto" />   <!-- Status/Error -->
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                    <materialDesign:PackIcon Kind="CashMinus" Width="28" Height="28"
                                             Foreground="{StaticResource PrimaryBrush}" VerticalAlignment="Center" />
                    <TextBlock Text="سند صرف سريع" FontSize="20" FontWeight="Bold" Margin="8,0,0,0"
                               VerticalAlignment="Center" />
                </StackPanel>

                <!-- رقم المستند -->
                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                    <TextBlock Text="رقم المستند" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <TextBox Text="{Binding PaymentNumber, Mode=OneWay}" IsReadOnly="True"
                             FontSize="13" Padding="8,6" Opacity="0.7" />
                </StackPanel>

                <!-- التاريخ -->
                <StackPanel Grid.Row="2" Margin="0,0,0,8">
                    <TextBlock Text="التاريخ" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <DatePicker SelectedDate="{Binding PaymentDate}" FontSize="13" Padding="4" />
                </StackPanel>

                <!-- الخزنة -->
                <StackPanel Grid.Row="3" Margin="0,0,0,8">
                    <TextBlock Text="الخزنة" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <ComboBox ItemsSource="{Binding Cashboxes}"
                              SelectedValue="{Binding SelectedCashboxId}"
                              SelectedValuePath="Id"
                              DisplayMemberPath="NameAr"
                              FontSize="13" Padding="8,6" />
                </StackPanel>

                <!-- المورد -->
                <StackPanel Grid.Row="4" Margin="0,0,0,8">
                    <TextBlock Text="المورد" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <ComboBox ItemsSource="{Binding Suppliers}"
                              SelectedValue="{Binding SelectedSupplierId}"
                              SelectedValuePath="Id"
                              IsEditable="True" IsTextSearchEnabled="True"
                              TextSearch.TextPath="NameAr"
                              FontSize="13" Padding="8,6">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Run Text="{Binding NameAr, Mode=OneWay}" />
                                    <Run Text=" (" Foreground="Gray" />
                                    <Run Text="{Binding Code, Mode=OneWay}" Foreground="Gray" />
                                    <Run Text=")" Foreground="Gray" />
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <!-- الرصيد الحالي -->
                <Grid Grid.Row="5" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="12" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="الرصيد الحالي" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                        <TextBlock Text="{Binding SupplierBalance, StringFormat='{}{0:N2}'}"
                                   FontSize="14" FontWeight="SemiBold" Padding="8,6"
                                   FlowDirection="LeftToRight" HorizontalAlignment="Left" />
                    </StackPanel>

                    <StackPanel Grid.Column="2">
                        <TextBlock Text="الرصيد بعد الصرف" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                        <TextBlock Text="{Binding BalanceAfter, StringFormat='{}{0:N2}'}"
                                   FontSize="14" FontWeight="SemiBold" Padding="8,6"
                                   FlowDirection="LeftToRight" HorizontalAlignment="Left"
                                   Foreground="{StaticResource SuccessBrush}" />
                    </StackPanel>
                </Grid>

                <!-- المبلغ المدفوع -->
                <StackPanel Grid.Row="6" Margin="0,0,0,8">
                    <TextBlock Text="المبلغ المدفوع" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <TextBox Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged, StringFormat='{}{0:N2}'}"
                             FontSize="14" Padding="8,6" FlowDirection="LeftToRight" />
                </StackPanel>

                <!-- اسم المستفيد -->
                <StackPanel Grid.Row="8" Margin="0,0,0,8">
                    <TextBlock Text="اسم المستفيد" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <TextBox Text="{Binding BeneficiaryName, UpdateSourceTrigger=PropertyChanged}"
                             FontSize="13" Padding="8,6" />
                </StackPanel>

                <!-- البيان -->
                <StackPanel Grid.Row="9" Margin="0,0,0,8">
                    <TextBlock Text="البيان" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                             FontSize="13" Padding="8,6" />
                </StackPanel>

                <!-- ملاحظات -->
                <StackPanel Grid.Row="10" Margin="0,0,0,8">
                    <TextBlock Text="ملاحظات" FontSize="12" Foreground="{StaticResource SubtitleBrush}" Margin="0,0,0,4" />
                    <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                             FontSize="13" Padding="8,6" AcceptsReturn="True"
                             TextWrapping="Wrap" MinHeight="50" MaxHeight="80"
                             VerticalScrollBarVisibility="Auto" />
                </StackPanel>

                <!-- Buttons -->
                <StackPanel Grid.Row="12" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,12,0,0">
                    <Button Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="{StaticResource SuccessBrush}" Foreground="White"
                            Command="{Binding SaveAndPostCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                            MinWidth="130" Margin="4,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CheckAll" VerticalAlignment="Center" />
                            <TextBlock Text="حفظ وترحيل" Margin="6,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="{StaticResource PrimaryBrush}" Foreground="White"
                            Command="{Binding SaveDraftCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                            MinWidth="120" Margin="4,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ContentSave" VerticalAlignment="Center" />
                            <TextBlock Text="حفظ كمسودة" Margin="6,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Command="{Binding CancelCommand}"
                            MinWidth="90" Margin="4,0">
                        <TextBlock Text="إلغاء" />
                    </Button>
                </StackPanel>

                <!-- Status / Error -->
                <StackPanel Grid.Row="13" Margin="0,10,0,0">
                    <TextBlock Text="{Binding ErrorMessage}" Foreground="{StaticResource DangerBrush}"
                               TextWrapping="Wrap" FontSize="12"
                               Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    <TextBlock Text="{Binding StatusMessage}" Foreground="{StaticResource SuccessBrush}"
                               TextWrapping="Wrap" FontSize="12"
                               Visibility="{Binding StatusMessage, Converter={StaticResource NullableToVisibilityConverter}}" />
                    <ProgressBar IsIndeterminate="True" Margin="0,6,0,0"
                                 Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
